# 1 ACID通常是 `Atomicity`, `Consistency`，`Isolation` 和 `Durabiltiy`。这四个属性通常有数据库引擎的事务来保证，你能谈谈这个话题吗？

数据库通过事务来保证数据的完全性，通常用 `ACID` 来表示。

- **Atomicity**

不同于多线程变种原子操作，数据库中的 `Atomicity` 描述了下述的情况，如果客户端打算执行若干次写操作，但是由于某种原因，其中的有部分操作失败了。如果这些操作被组合成一个事务（transaction），那么数据库丢弃掉这些操作，数据库并不会生成 `脏` 数据。这样很方便进行重试操作。

- **Consistency** 

对于数据库中，你可以声明一些一定正确的语句。比如说对于财务的数据，所有账户的财务数据是平衡的。当然这个通常也取决于应用程序，如果刻意写入不合法的数据，数据库也不能阻止其发生。但是有些数据库会对写入的数据会做一些校验，比如日期字段合法性。

- **Isolation**

通常一个数据库被会多个客户端同时访问，如果都是读取或者修改不同的部分没有什么问题，但是如果同时修改的相同的部分，就会导致类似条件竞争的情况发生。数据库的 `Isolation` 意味着并发执行的事务是各自独立的，通常也叫做序列化。但是在实际中很少会使用序列化来完成 `Isolation`，因为有性能方面的损失。

- **Durability**

`Durability` 是一种数据库中一种承诺，一旦事务成功完成，那么它写入的数据就不会忘记。


# 2 什么叫做`Blue-Green Deloyment`

`Blue-Green Deployment` 是一种减少服务宕机时间和避免 regression 的方法，它提供了两套一摸一样的生产环境，分别称之为 `Blue` 和 `Green`。

![](./images/blue_green_deployments.png)

在任何时刻，只有一个环境是工作的，它承载的所有生产环境中的流量，而另一个环境则处于闲置状态。比如上图中，绿色的部分为工作环境，而蓝色部分处于闲置状态。

当你为软件开发出新的版本，在闲置的环境中部署，并且执行完全部的测试，比如在蓝色的环境中完成这些工作。然后在路由中切换所有的流量到新部署的环境中，那么现在绿色部分的环境就变为闲置。

这样做减少了宕机的时间，而且降低了风险，因为一旦新的软件版本出现问题，可以立马将路由切回到原来的环境，完成回滚。

这个设计通常要保证 `Green` 和 `Blue` 两套环境一摸一样，而且使用同一份数据。这样对于数据库的设计提出了挑战，尤其是在新的软件版本中需要修改数据库的 schema，因为一旦 rollback 就会导致不同版本之间的兼容性，解决办法就是将数据库升级和软件升级区分开来。